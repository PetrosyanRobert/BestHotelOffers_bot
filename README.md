<h1 align="center">Best Hotel Offers Bot

</h1>

<img src="./for README/bots_logo.png" width="30%">

___
[comment]: <> (License: )

**[Telegram-бот](http://t.me/best_hotel_offers_bot) для анализа сайта [Hotels.com](https://ru.hotels.com/) 
и поиска подходящих пользователю отелей.** 

Бот, согласно определённым критериям и запросам пользователя, анализирует текущие предложения по отелям на платформе 
[**Hotels.com**](https://hotels.com/) и выдаёт необходимый результат. Для этого бот использует открытый **API Hotels**, 
который расположен на сайте [**rapidapi.com**](https://rapidapi.com/apidojo/api/hotels4/)

Пользователь с помощью специальных команд бота может получить следующую информацию:

- **/lowprice** - Выводит топ самых дешёвых отелей в выбранном городе. 
- **/highprice** - Выводит топ самых дорогих отелей в выбранном городе. 
- **/bestdeal** - Выводит топ отелей, наиболее подходящих по цене и расположению от центра выбранного города
(т.е. самые дешёвые и которые находятся ближе всего к центру города). 
- **/history** - Выводит историю поиска отелей. 

Подробнее работа команд приводится далее.
<br>Бота можно найти под именем [**@best_hotel_offers_bot**](http://t.me/best_hotel_offers_bot)
***

## Первым делом
Инструкции ниже помогут Вам установить копию проекта на Ваш локальный компьютер и запустить его для тестирования 
или дальнейшей разработки.

### *Необходимые требования к установке*
Для самостоятельного запуска бота на Вашем локальном компьютере необходимо предварительно скачать и установить 
следующие программы и библиотеки:

- [**Python**](https://www.python.org/) версии **3.10** или выше (сам бот написан на версии 3.10.1)
- Библиотека [**pyTelegramBotAPI**](https://github.com/eternnoir/pyTelegramBotAPI) версии 4.4.0
- Библиотека [**python-dotenv**](https://github.com/theskumar/python-dotenv) версии 0.20.0
- Библиотека [**loguru**](https://github.com/Delgan/loguru) версии 0.6.0
- Библиотека [**requests**](https://github.com/psf/requests) версии 2.27.1
- Библиотека [**peewee**](https://github.com/coleifer/peewee) версии 3.14.10

### *Установка*

- Скачайте и установите [**Python 3.10**](https://www.python.org/downloads/) или выше.
- Создайте виртуальное окружение (рекомендуется использовать `virtualenv`).
- Создайте на своем компьютере папку с названием проекта.
- Склонируйте данный репозиторий в Вашу папку проекта `git clone https://github.com/...`
- Создайте в ней файл `.env` (можете использовать файл `env.example` по инструкции ниже).
- Создайте нового бота в **Telegram** у отца всех ботов [**@BotFather**](http://telegram.me/BotFather), 
получите токен и добавьте его в файл `.env`.
- Придумайте название Вашей БД и тоже добавьте его в файл `.env`.
(БД будет создана автоматически при первом запуске бота).
- Зарегистрируйтесь на сайте [**rapidapi.com**](https://rapidapi.com/), затем перейдите на документацию 
[**Hotels API Documentation**](https://rapidapi.com/apidojo/api/hotels4/), нажмите на кнопку [**Subscribe to Test**], 
выберите бесплатный пакет (**Basic**), получите хост и ключ доступа и их тоже добавьте в файл `.env`.
- Наконец установите необходимые библиотеки: `pip install -r requirements.txt`

### *Содержимое файла* `env.example`:
```
EXECUTE_CMD = python <your bots file name>
BOT_TOKEN = <your bots token>
DATABASE = <your database file name>
API_HOST = <your x-rapidapi-host>
API_KEY = <your x-rapidapi-key>
```
- Отредактируйте этот файл, добавьте нужные данные между угловых скобок **<your ...>** 
(естественно, скобки нужно удалить)
- Переименуйте имя файла с `env.example` на `.env`.

### *Запуск и остановка бота*
- Для запуска бота в папке с проектом откройте командную строку и наберите команду: `python main.py`.
- Для остановки бота при активном окне командной строки нажмите **[Ctrl]+ C**


### *Работа с базой данных (БД)*

При первом запуске бота создаётся БД с заданным Вами именем и с необходимыми (пустыми) таблицами.
<br>Если по каким-либо причинам этого не произошло, то в командной строке наберите: `python bot_db_pw.py --force`
<br>Данная команда удаляет все таблицы из БД и затем создаёт их заново.

**Внимание!** После этой команды из БД удаляются данные всех пользователей и их история поиска!!!
***

## Описание работы команд

### *Команда /start* 

При первом вводе команды бот приветствует пользователя, коротко представляется и затем выводит команду **/help**. 
<br>При втором и последующих вводах команды бот предлагает начать заново и сразу выводит команду **/help**.


### *Команда /help* 

После ввода команды пользователю выводится список всех команд с кратким описанием каждой из них.


### *Команда /lowprice* 

После ввода команды у пользователя запрашивается: 
1. Город, где будет проводиться поиск.
2. Дата заезда и выезда.
3. Количество отелей, которые необходимо вывести (не более 10).
4. Необходимость загрузки и вывода фотографий для каждого отеля (“Да/Нет”). 
<br>4.1 При положительном ответе пользователь также вводит количество необходимых фотографий.


### *Команда /highprice*

После ввода команды у пользователя запрашивается: 
1. Город, где будет проводиться поиск.
2. Дата заезда и выезда.
3. Количество отелей, которые необходимо вывести (не больше 10)
4. Необходимость загрузки и вывода фотографий для каждого отеля (“Да/Нет”). 
<br>4.1 При положительном ответе пользователь также вводит количество необходимых фотографий.


### *Команда /bestdeal*

После ввода команды у пользователя запрашивается: 
1. Город, где будет проводиться поиск.
2. Дата заезда и выезда.
3. Диапазон цен.
4. Диапазон расстояния, на котором находится отель от центра города.
5. Количество отелей, которые необходимо вывести (не больше 10)
6. Необходимость загрузки и вывода фотографий для каждого отеля (“Да/Нет”). 
<br>6.1 При положительном ответе пользователь также вводит количество необходимых фотографий.


### *Команда /history*

После ввода команды у пользователя запрашивается период, за который нужно выводить историю 
(**последний поиск, за последний день, за последний месяц**), затем пользователю выводится история поиска отелей.
<br><br>Сама история содержит: 
1. Дату и время ввода команды.
2. Команду, которую вводил пользователь.
3. Город, где проводился поиск (со ссылкой, содержащий полный поисковый запрос на сайт).
4. Список найденных отелей (со ссылками на страницу каждого отеля).


### *Команда /reset* 

После ввода команды сбрасываются все параметры поиска пользователя и удаляется вся история его команд.

***

## Описание внешнего вида и UI
Окно Telegram-бота при запущенном Python-скрипте воспринимает следующие команды: 
- /start - запуск сценария бота 
- /help - помощь по командам бота 
- /lowprice - вывод самых дешёвых отелей
- /highprice - вывод самых дорогих отелей
- /bestdeal — вывод отелей, наиболее подходящих по цене и расположению от центра
- /history - вывод истории поиска отелей
- /reset - сброс параметров и удаление истории поиска

Для команд **/lowprice**, **/highprice** и **/bestdeal** сообщение с результатом содержит краткую информацию 
по каждому отелю. В эту информацию входит: 
- Фотографии отеля (если пользователь счёл необходимым их вывод)
- Название отеля
- Категория отеля
- Адрес отеля (со ссылкой на Google Maps) 
- Ближайшие ориентиры (в т.ч. как далеко расположен от центра)
- Цена за одну ночь
- Общая сумма за кол-во ночей
- Ссылка на страницу отеля на Hotels.com

В конце вывода всех отелей пользователю выводится ещё и ссылка с его параметрами запроса на страницу Hotels.com
***

## Скриншоты

Пример вывода отеля в результате поиска:

<p>

<img src="./for README/hotel_view.png" width="30%">

</p>

<br><br>
***

## Благодарности

Выражаю свою особую благодарность преподавателям и кураторам образовательной платформы 
[**Skillbox**](https://sale.skillbox.ru/invite/?invite_hash=9a438762-b27c-4f8c-b51f-d04bdc36ced3&utm_source=invite_pr)
за их наставничество.

Также благодарю:
- [**DePreto**](https://github.com/DePreto/tg_bot) - за некоторые идеи в реализации проекта
- [**artembakhanov**](https://github.com/artembakhanov/python-telegram-bot-calendar) - за код календаря, 
который используется в выборе дат заезда/выезда.
***

## Что же дальше?

Далее планируется:
- Добавить английский язык
- Возможность выбора вылюты
- Добавить **UI** для ввода переводов на др. языки
